-- test the lib/longfellow-zk primitives in zenroom lua

-- examples from mdoc_examples.h
mdoc_tests = {
    -- First example only has "age_over_18"
    [1] = {
        pkx = O.from_hex'2c80c10bf70f63bddcc41ea20d76a22ecba2a97fa8811bf19d572433b12c0c1f',
        pky = O.from_hex'3f994c043be7e17dd08387281bac0c37a529361b3cb36a0fac38d41ac066f903',
        transcript = O.from_hex'83f6f68471416e64726f696448616e646f766572763158202e1005b3a9c8f0df04db423001c8b53903fed071ba5024c3ba69740e62d4917e5819636f6d2e616e64726f69642e6d646c2e6170707265616465725820d8e73c7060e3e80d3defc2634eb04d08c656e26068d8a563f5b94585dae14fad',
        transcript_size = 117,
        now = O.from_string'2024-01-30T09:00:00Z',
        doc_type = O.from_string'org.iso.18013.5.1.mDL',
        mdoc_size = 1452,
        mdoc = O.from_hex('a36776657273696f6e63312e3069646f63756d656e747381a367646f6354797065756f72672e69736f2e31383031332e352e312e6d444c6c6973737565725369676e6564a26a6e616d65537061636573a1716f72672e69736f2e31383031332e352e3181d818584fa4686469676573744944006672616e646f6d50f11059eb6fbce62655dfbd6f83b8967071656c656d656e744964656e7469666965726b6167655f6f7665725f31386c656c656d656e7456616c7565f56a697373756572417574688443a10126a1182159022730820223308201a9a0030201020210476f6f676c655f546573745f44535f31300a06082a8648ce3d040303303c310b3009060355040613025553310e300c0603550408130555532d4d41311d301b06035504030c14476f6f676c6520544553542049414341206d444c301e170d3233303732363030303030315a170d3234313032353030303030315a303a310b3009060355040613025553310e300c0603550408130555532d4d41311b301906035504030c12476f6f676c652054455354204453206d444c3059301306072a8648ce3d020106082a8648ce3d030107034200042c80c10bf70f63bddcc41ea20d76a22ecba2a97fa8811bf19d572433b12c0c1f3f994c043be7e17dd08387281bac0c37a529361b3cb36a0fac38d41ac066f903a3818e30818b301f0603551d23041830168014def3ab6d37de9e3a816e1032d02b48af358a71ab301d0603551d0e04160414397be53c50dff0d7a2e4a9e465ea737a9ed892c8300e0603551d0f0101ff04040302078030220603551d12041b3019861768747470733a2f2f7777772e676f6f676c652e636f6d2f30150603551d250101ff040b3009060728818c5d050102300a06082a8648ce3d0403030368003065023100a25cdb8a6f0c23905b9d3f582a608f0c16f436b5eee3587d2ca977167c6f16a2b9de10fe1ddd16de072e4f866f0605a702306a4889421f9bb374b8bde175b3d6ab23216ba97e689510974ae0f659a10e958469b5bd80dfc10588831d931981a639985901e8d8185901e3a66776657273696f6e63312e306f646967657374416c676f726974686d675348412d32353667646f6354797065756f72672e69736f2e31383031332e352e312e6d444c6c76616c756544696765737473a1716f72672e69736f2e31383031332e352e31a5015820adf6a333036adefc4890df38e0f737229085a9b0ba7c0719d392405d74462377025820a0a14a5aa1b336844d8f8d148ed44fd2ccc66f54d8782b70fb7713fb3c93f55603582097b0184edde399cb7dea2d7d279a456990d9f312467163787e1ba7660a5c086f045820af0b9fe7245ca9a59f64b1aa82cc2c1ab1386f77956493836297c8a84d2ae0b40058200d9854db51486ff44907bc614ffaea93dae1a89ead40263f901ae6ce412646216d6465766963654b6579496e666fa1696465766963654b6579a401022001215820c314a7abba07e40e64ae87db4ad9718013fd398e6e2317b304f57fc9accab9f5225820edb8b0230ccc98dd42cdff89a8d1e25ff8d1a7fa389e92dc8f01af985a79efcc6c76616c6964697479496e666fa3667369676e6564c074323032342d30312d32355432313a31323a35395a6976616c696446726f6dc074323032342d30312d32355432313a31323a35395a6a76616c6964556e74696cc074323032342d30322d32345432313a31323a35395a584067007be995a3e743945c4fb1c58ae89d72d497318251d9f1974f08e51389c86d401101488fc37e6655464953c51c4f8c64b96013a1ab04a9a65b80fd2f3b5ca36c6465766963655369676e6564a26a6e616d65537061636573d81841a06a64657669636541757468a16f6465766963655369676e61747572658443a10126a0f65840cfb0ac1a631b06e1b5d50316fa43dab23886a26b676c33bab452634cbadfd1b3abd1bd7a5e3c3697de7ce1fc004a90de84e06264fe95788198acdc3e4c575d596673746174757300')
    },
    [2] = {
        pkx = O.from_hex'2c80c10bf70f63bddcc41ea20d76a22ecba2a97fa8811bf19d572433b12c0c1f',
        pky = O.from_hex'3f994c043be7e17dd08387281bac0c37a529361b3cb36a0fac38d41ac066f903',
        transcript = O.from_hex'83f6f68471416e64726f696448616e646f766572763158202e1005b3a9c8f0df04db423001c8b53903fed071ba5024c3ba69740e62d4917e5819636f6d2e616e64726f69642e6d646c2e6170707265616465725820d8e73c7060e3e80d3defc2634eb04d08c656e26068d8a563f5b94585dae14fad',
        transcript_size = 117,
        now = '2024-01-31T09:00:00Z',
        doc_type = O.from_string'org.iso.18013.5.1.mDL',
        mdoc = O.from_hex'a36776657273696f6e63312e3069646f63756d656e747381a367646f6354797065756f72672e69736f2e31383031332e352e312e6d444c6c6973737565725369676e6564a26a6e616d65537061636573a1716f72672e69736f2e31383031332e352e3181d818584fa4686469676573744944026672616e646f6d5052d83deedc0bf66205835ccc16ad682d71656c656d656e744964656e7469666965726b6167655f6f7665725f31386c656c656d656e7456616c7565f56a697373756572417574688443a10126a1182159022730820223308201a9a0030201020210476f6f676c655f546573745f44535f31300a06082a8648ce3d040303303c310b3009060355040613025553310e300c0603550408130555532d4d41311d301b06035504030c14476f6f676c6520544553542049414341206d444c301e170d3233303732363030303030315a170d3234313032353030303030315a303a310b3009060355040613025553310e300c0603550408130555532d4d41311b301906035504030c12476f6f676c652054455354204453206d444c3059301306072a8648ce3d020106082a8648ce3d030107034200042c80c10bf70f63bddcc41ea20d76a22ecba2a97fa8811bf19d572433b12c0c1f3f994c043be7e17dd08387281bac0c37a529361b3cb36a0fac38d41ac066f903a3818e30818b301f0603551d23041830168014def3ab6d37de9e3a816e1032d02b48af358a71ab301d0603551d0e04160414397be53c50dff0d7a2e4a9e465ea737a9ed892c8300e0603551d0f0101ff04040302078030220603551d12041b3019861768747470733a2f2f7777772e676f6f676c652e636f6d2f30150603551d250101ff040b3009060728818c5d050102300a06082a8648ce3d0403030368003065023100a25cdb8a6f0c23905b9d3f582a608f0c16f436b5eee3587d2ca977167c6f16a2b9de10fe1ddd16de072e4f866f0605a702306a4889421f9bb374b8bde175b3d6ab23216ba97e689510974ae0f659a10e958469b5bd80dfc10588831d931981a6399859020bd818590206a66776657273696f6e63312e306f646967657374416c676f726974686d675348412d32353667646f6354797065756f72672e69736f2e31383031332e352e312e6d444c6c76616c756544696765737473a1716f72672e69736f2e31383031332e352e31a60158206b6ee3d4971366b2da895f8b79b00835d4eb9e367ba200210639c9a224d56191005820971e94b33456bb45d17e9ae558a3515f68b4662722b2ee3c20989152c2adc071045820640a32ae3eea2730e1db112756ec6500a2abee2be6e750e23c38b75527f18f37055820287e504bd35c0f8fa823916650d3c8a98d384150e795f62a1144da45c091213b035820d17f88f61779aac0a100d0dda0dd4585bd7b2ce5992247f3ed4fdcd71d9cfacc0258209622a2d9fe02ecbe3c631d9abb9405f508edd0f43e5f1251c9d7f879e696cb606d6465766963654b6579496e666fa1696465766963654b6579a401022001215820c54e80bda8a1e1ba9266cbe74c7a73cf7908e2985823c91a9cb1fe5798529dfb2258201ac32f5c024dd7a7861d2ab897543a1e17970477abd38863a5b8de2233d1db956c76616c6964697479496e666fa3667369676e6564c074323032342d30312d32365431353a33323a35305a6976616c696446726f6dc074323032342d30312d32365431353a33323a35305a6a76616c6964556e74696cc074323032342d30322d32355431353a33323a35305a5840ac87aa0260b836229d1ea2852f3ca32aa3639d260c00da812422bbd45fc2053708ff7050decc2dfcfd3abafeea3d68e514b524e4c2eef8ad28ecd31421fb9f8f6c6465766963655369676e6564a26a6e616d65537061636573d81841a06a64657669636541757468a16f6465766963655369676e61747572658443a10126a0f65840f2a259cc16bf5c3052684b1f166207d593ff5b0e1da8c144c0b6e90d537bde4939e7e8a0fa24708e5a5924b95352d64f020b5989971f091ca1fe05e25b459d866673746174757300',
        mdoc_size = 1486
    },
    [3] = {
		pkx = O.from_hex'cc900843699408936c912474a27abb7b62d7c90e4f6d8557714825476eee2366',
        pky = O.from_hex'b19764d33b530e9bd6a87081f1d8e5cbc80db640ac962ee8a3e0393c14c6bfb4',
        transcript = O.from_hex'83f6f68476476f6f676c6557616c6c657448616e646f766572763144010203047822636f6d2e676f6f676c652e616e64726f69642e676d732e746573742e77616c6c65745820b0d381797d0a064b5ebecffd9c8b0f1288fc83b859c7608e9105143025512c54',
        transcript_size = 102,
        now = O.from_string'2024-05-05T09:00:00Z',
        doc_type = O.from_string'org.iso.18013.5.1.mDL',
        mdoc = O.from_hex'a36776657273696f6e63312e3069646f63756d656e747381a367646f6354797065756f72672e69736f2e31383031332e352e312e6d444c6c6973737565725369676e6564a26a6e616d65537061636573a1716f72672e69736f2e31383031332e352e3181d8185861a4686469676573744944181d6672616e646f6d58203d0264c007375a43620c37c0cc5c873e1532a52f5d320e05c0fb176c0cd9bab171656c656d656e744964656e7469666965726b6167655f6f7665725f31386c656c656d656e7456616c7565f56a697373756572417574688443a10126a118215902de308202da3082023ba003020102021409bd7c4d2d531a2c79bf503629408ee8fd40c889300a06082a8648ce3d0403043040310f300d060355040a0c06476f6f676c65310b3009060355040613025a5a3120301e06035504030c17554c2054455354494e472053746167696e6720526f6f74301e170d3234303432363135343934355a170d3235303432363135343934355a303e310f300d060355040a0c06476f6f676c65310b3009060355040613025a5a311e301c06035504030c15554c2054455354494e472053746167696e672044533059301306072a8648ce3d020106082a8648ce3d03010703420004cc900843699408936c912474a27abb7b62d7c90e4f6d8557714825476eee2366b19764d33b530e9bd6a87081f1d8e5cbc80db640ac962ee8a3e0393c14c6bfb4a38201133082010f301f0603551d2304183016801473a7041e5081939ee0dbb7028ae3712fd0aa36c1300e0603551d0f0101ff04040302078030210603551d12041a3018861668747470733a2f2f7777772e676f6f676c652e636f6d3081820603551d1f047b30793077a075a0738671687474703a2f2f7072697661746563612d636f6e74656e742d36363033633634372d303030302d323964342d616561362d6634663565383064316239302e73746f726167652e676f6f676c65617069732e636f6d2f34316434333638353965343564626633653561392f63726c2e63726c30150603551d250101ff040b3009060728818c5d050102301d0603551d0e041604147cfd80e8383f665c9d6e2ba3bef67805f6165113300a06082a8648ce3d04030403818c00308188024201fb9069f73ec86749fb2b12472abb431744f08885001acb1ceab4eb575d34b128443da538111b410efe65eafbc2b42f5c60837c38a022e1988c45e5f3b78763a055024200d0152a3594155fc459379025078d3ab1232a13227f13f749e393dd2bcdb6f7da00c4c2a56e9c0c239fa0740b222b71c227f4a8946243580751a93a8cbfeda1208859083cd818590837a66776657273696f6e63312e306f646967657374416c676f726974686d675348412d3235366c76616c756544696765737473a2716f72672e69736f2e31383031332e352e31b82b0058205ba21553e643e520abde9781419ba3309e78699225d5635f4fe3a501c7870b9c0158206342518eb0685a92e04d2d8cf8fda88fad35e18d778348c22df981096329264002582049be06cdf4b61fe16ab34b3df5308dff422aed4fd9dbdb0e820dadf7ae1dcf9e035820c64d5738992659e5d23c79aafcde6aa89fa7517a6e63d473e8a01bd45fa3bae3045820a25d81d83272d36d11768c02ab103a8bdcd6ae3b325c511acd87dbe564ba611a055820466c840e422b42436a9ef60ae8d58b1c6e27abd3a85efa082dbbb991a771ec4706582007b4cc54efd01db32298e5778b6143d165ebe11165194c34ed7b21e451325348075820742fc6b94d42f4b5093b2e09f0ed05337028c102d84b0b83d617b35eebe47d6b085820c5c26f0d3f596f96162ebec7ccaefbf8a29d77219d21d6f9c2ec62f40f76321e095820ecff298bb30489107d678a22d10cc3009396a0a4c85b420379c49925cd84ce990a582083986e01d126f04d451cf083e71e240e3a9ee2240686f1c9c779e7093e6630900b58205d9e053d1af186ad9df4c1eb6bec06aab5ab1df3fe43597fe49218cd058198990c58203ada36a4a734e3b8973c1732dbcc716788383b1154eaf4818b58bfd9f82983130d5820291b1871da7978b9c4e52b1a6dfc142974729de82f1496440a5372b7194c8d4e0e5820474b99284bf4e7131c749d852ccbdf29a726454b55969e55fe0f47d41aad5dfb0f5820e098db138430b26cc33cb315cc820ec4ea4b4b38f75a54e6a64c7cf09b5ff2c5105820fe68bd1ddef4c760fdf96b19af5f5a7f82c526b9cc66e4e37a243d3304911f5c11582091364e16853ffe4fa1509787d89dff123b6b1fc473e9e0aa070acefcbf25f69a12582089db3e9ba20eb016d280cd2be2e586dbacc5c83bb5109e8d01a3d2771e6ea81f1358209bb53608506ce0033b8849efd5eb1558e714ca057a57a0cb007867d43c8f6f79145820333b9b2872be3d76daeb790e088655cc637852171157719fe38d6ce9f7c35e37155820e9d4874e064c64f095ffafd3ce332c6b5c31f11efe696f3a9bbf6c2a37699ff716582066f253a4c5e0c9185c2945ee2d93c640fd1c55cfacf644d8a79b26cac432df0c17582079a3910fba84419127a3cb41fc755167eef99f6c32559ebce25e815d6e0e7d1818185820002b448179d9dedeb672b12abdd1edfecff43d3031a89397d76d263e7f688aad1819582002f77dac9f51089201ec789a983ca80d6051cca1da983bb8cb8eb7e0c702af0a181a58200b0e24dba74648ad2f1cbb664146f7329ea4fe57e2fa5b14b69a7f3e3d98a010181b58207f8c391ce7cd6daa75ebd7b5cd32f61cd4f1dde45abaa1badf35671c94a81840181c582045522aabfe535e050716810f0a726b7900c5f7c29deb160b7e1b38e4427f102c181d582096610d459e4bf569b67362cf0855ffb3dd76c70b624948ce63d59390a262ba27181e5820ce79a1c58375955e0014dc4f2bdbc33e26796c0c5b32da2340a43b2dc98134f0181f582078716e520bcfc9775974887d4187e20cefb979e0a7f5d1c4df11e7dd9c21ed38182058205fc6ed7146a0f4e38297591a5886ba9162f865ccf7a60d7eb7dc0b97b3eda2df18215820221dec99f8e53affc1ac36980edd30d245a07d9e8a8ffef84ec441531d62ed56182258202b1acddaf5a535c943f9770d180e296e1ea748bdd35cc8effe6da669669f014d18235820776cc879558df55b38c78ebedfbf808cfe421f24ebd6161a8bbff4c95470829a182458204b7e0f5163bea376cf4776bd52a7765728ebae1d1750c2c9c5b8a308b33a4ffd182558200d769d48035516ca03595c7fa60dd432fe75e0881110156489668f92d1c01bcb182658200270127ab666445753d61252caf05d4a2f207735cae9349ddf352c27eae76ee818275820429a96e37951b1d8999828814aa25268f8eb6953ce417fa993f8d147f2e0e74518285820f503b9308e6345b99e0f01c673c2cf0f845e22fe1f776ac8e41eb190588daf6a18295820ae025f21b2089df9216d6c7d6550f3364b42197b1f3fe26372dc9c0ca7e30c08182a58203ecd92c49c3fee1841a9a5d76e9ed5f0fd06227298e7876d25c1f61f79b437c0776f72672e69736f2e31383031332e352e312e61616d7661a7005820b93d0594af96fe771ac8797f9e7576f8d3a7d314317a7c6c2932bce1f4de4f64015820d8365423072f73bf62884620d8b6dc27b227e656c7d6b25eb0d6c8d5e25c4a44025820c1cb4f9aa41b2f9ba17a33af86acbc4716f38ef8919f19d98afc337c415fe61d03582045db9c8f0ae343090f2a39079e89a46afbb4871bc8c7704462c0f43548277480045820370f262067831c851d7784b1395e739e8fa025e18b9237dfa71005876eb48b060558208cb6a40506f7b10120324695ef2015ad45be933314b75ea2b250d68ba973d009065820e9004002f959c8e1802d9bb2956ec00758186ed1026194a13cc67956344a6cd56d6465766963654b6579496e666fa1696465766963654b6579a401022001215820d803409d106075eb4583e1ca94ad542b5779f1e864a8d24681a1a62e3b50dbd3225820d6663f27766668026a250c9ed2cbbbddd757e3038aeaf1078fdab5d2b1826ba06c76616c6964697479496e666fa3667369676e6564c074323032342d30352d30335430373a30303a30305a6976616c696446726f6dc074323032342d30352d30335430373a30303a30305a6a76616c6964556e74696cc074323032352d30352d30335430373a30303a30305a67646f6354797065756f72672e69736f2e31383031332e352e312e6d444c5840fb3777d9bf2d2526e30d8df459e09e704828408d60a7c13c14e94fe43df35ee2af86e96087f0401bd0a72f6e4516dfa99db1f1b72da5b7394f8626e1985927af6c6465766963655369676e6564a26a6e616d65537061636573d81841a06a64657669636541757468a16f6465766963655369676e61747572658443a10126a0f65840efdeb6a091855f911c5f9468d04fe39beeff3c9eb4324ac4769a5e812d52453bc648f8c5e03d12677df4f96b9e56b0c50f737a02f76b6f25e2502834a51d31476673746174757300',
        mdoc_size = 3272
    }
}

function describe_circuit(ver, circuit)
    local size = #circuit
    print("circuit size: "..size)
    print("recalculated circuit id:")
    print(LFZK.circuit_id(circuit, ver):hex())
end
LFZK = require'longfellow'

example = mdoc_tests[3]
assert(example.transcript_size == #example.transcript)
assert(example.mdoc_size == #example.mdoc)

-- I.print(deepmap(O.to_string,example))

circ = LFZK.gen_circuit(1)
describe_circuit('1',circ)

print'generate proof'
proof = LFZK.mdoc_prove(circ,
                        example.mdoc,
                        example.pkx,
                        example.pky,
                        example.transcript,
                        {{id='age_over_18',value=O.from_hex'f5'}},
                        example.now, 1)

-- circ = LFZK.gen_circuit(2)
-- describe_circuit('v2',circ)

-- circ = LFZK.gen_circuit(3)
-- describe_circuit('v3',circ)

-- circ = LFZK.gen_circuit(4)
-- describe_circuit('v4',circ)
